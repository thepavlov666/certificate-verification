<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Newcastle College Qualification Checker</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #2c3e50; }
    label, input, button { display: block; width: 100%; margin-bottom: 15px; }
    input { padding: 10px; font-size: 16px; }
    button { background: #0077cc; color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; }
    .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
    .verified { background: #e0ffe0; border: 1px solid #0c0; color: #060; }
    .not-found { background: #ffe0e0; border: 1px solid #c00; color: #600; }
    #reader { width: 100%; margin-top: 20px; display: none; }
    .loading { text-align: center; font-style: italic; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Newcastle College™ Qualification Checker</h1>

    <label for="number">Qualification Number</label>
    <input type="text" id="number" placeholder="e.g., UKQ-001-A" />

    <label for="name">Candidate Name</label>
    <input type="text" id="name" placeholder="e.g., Benjamin Wayne" />

    <button onclick="verifyQualification()">Verify Certificate</button>
    <button onclick="startScanner()">Scan QR Code</button>

    <div id="reader"></div>

    <div class="loading" id="loading" style="display:none;">Verifying, please wait...</div>
    <div class="result" id="result"></div>
  </div>

  <script>
    const numberInput = document.getElementById("number");
    const nameInput = document.getElementById("name");
    const resultDiv = document.getElementById("result");
    const loading = document.getElementById("loading");
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbyjeFW_7QB5WEfODasBAFosMACSA3XcPyZsOHkMpEI/dev';

    function verifyQualification() {
      const number = numberInput.value.trim();
      const name = nameInput.value.trim();

      if (!number || !name) {
        resultDiv.innerHTML = '<div class="not-found">❌ <strong>INPUT REQUIRED</strong><br>Please enter both a Qualification Number and Candidate Name to proceed.</div>';
        return;
      }

      loading.style.display = 'block';

      fetch(`${scriptUrl}?qualificationNumber=${encodeURIComponent(number)}&name=${encodeURIComponent(name)}`)
        .then(response => response.json())
        .then(data => {
          loading.style.display = 'none';
          if (data.found) {
            resultDiv.innerHTML = `<div class="verified">✅ <strong>VERIFIED CERTIFICATE</strong><br><br><b>Name:</b> ${data.name}<br><b>Qualification:</b> ${data.level}<br><b>Awarded By:</b> ${data.awardedBy}<br><b>Year Awarded:</b> ${data.year}<br><br><i>Stored securely in the Newcastle College™ National Record Vault.</i><br><b>OFQUAL Regulated Qualification</b></div>`;
          } else {
            resultDiv.innerHTML = '<div class="not-found">❌ <strong>NOT FOUND</strong><br>The qualification number or candidate name appears invalid or unregistered in the Newcastle College™ database.<br>Please check your details and try again or contact Newcastle College for assistance.</div>';
          }
        })
        .catch(error => {
          loading.style.display = 'none';
          resultDiv.innerHTML = `<div class="not-found">⚠️ <strong>ERROR</strong><br>Unable to connect to the verification service. Please try again later.<br><small>${error.message}</small></div>`;
        });
    }

    function startScanner() {
      const qrReader = new Html5Qrcode("reader");
      document.getElementById("reader").style.display = "block";

      qrReader.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText, decodedResult) => {
          try {
            const parts = decodedText.split("|");
            if (parts.length >= 2) {
              numberInput.value = parts[0].trim();
              nameInput.value = parts[1].trim();
              qrReader.stop();
              document.getElementById("reader").style.display = "none";
              verifyQualification();
            }
          } catch (e) {
            console.error("QR Parsing error:", e);
          }
        },
        errorMessage => {
          // Ignore scanning errors
        }
      ).catch(err => console.error("QR Scanner start error:", err));
    }
  </script>
</body>
</html>
